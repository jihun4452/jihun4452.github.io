---
layout: post
title: "DataBase002"
date: 2024-10-27
categories: [나만의 공부 데이터베이스편]
---

# Part 1. H2 데이터베이스, JDBC 커넥션 풀

## 커넥션 풀
커넥션은 새로 만드는 것이 복잡하다. 
고객이 이를 실행할 때 시간이 오래 걸린다. MySQL은 금방 끝난다.  
그래서 **커넥션 풀**이라는 기능을 이용한다. 커넥션 풀은 미리 작성해 둔 것을 꺼내서 사용하는 것이다. (수영장이라고 생각하면 된다 == **풀**)  
필요한 만큼 미리 확보해 풀에 보관한다.

커넥션 풀에 들어있는 커넥션은 **TCP/IP**로 DB와 커넥션이 연결되어 있는 상태이기 때문에 언제든 꺼내올 수 있다는 장점이 있다.

DB 드라이버를 통해 커넥션을 새로 획득하는 것이 아니다. 이미 생성되어 있는 것을 쓰는 것일 뿐이다. 요청을 하면 자신이 가지고 있는 정보를 준다.

커넥션을 모두 사용하면 이제는 커넥션을 종료하는 것이 아니라, 다음에 다시 사용 가능하도록 다시 수영장에 풀어줘야 한다. 여기서 
커넥션은 종료가 아니라 **살아있는 상태로 커넥션 풀에 반환**해야 한다.  
적절한 풀의 숫자는 성능 테스트를 통해 정해야 하며, 최대 커넥션 수를 저장 가능하다. DB는 무한정 연결 생성을 막아줘야 해서 보호 효과도 있다.

**실무에서는 항상 기본으로 사용**한다!

그래서 오픈 소스 형태로 사용하며, 다른 사람들이 만들어놓은 커넥션 풀이 많기 때문에 직접 사용하지 않는다.  
스프링 2.0부터는 **HikariCP**를 제공하기 때문에 따로 설정하지 않아도 된다.

## DataSource
우리가 JDBC로 개발한 애플리케이션은 **DriverManager**를 통해 커넥션을 획득하다가 커넥션 풀로 바꾸려면 어떻게 해야 할까?  
원래는 코드를 다 변경해야 했지만, **DataSource**는 커넥션을 획득하는 방법을 추상화한 것이기 때문에 따로 코드를 바꾸지 않아도 된다.  
모든 커넥션은 **DataSource**를 의존시켜야 한다.
